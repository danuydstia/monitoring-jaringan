{% extends "base.html" %}
{% block title %}History - {{ device[1] }}{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Kembali
    </a>
</div>

<div class="card shadow mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">
            <i class="bi bi-clock-history"></i> History Monitoring: {{ device[1] }} ({{ device[2] }})
        </h5>
    </div>
    <div class="card-body">
        <p class="text-muted">{{ device[3] }}</p>
    </div>
</div>

<!-- Statistics Cards -->
{% if stats %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Average Latency</h6>
                <h3 class="text-info">{{ "%.2f"|format(stats.avg_latency) }} ms</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Minimum Latency</h6>
                <h3 class="text-success">{{ "%.2f"|format(stats.min_latency) }} ms</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Maximum Latency</h6>
                <h3 class="text-danger">{{ "%.2f"|format(stats.max_latency) }} ms</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h6 class="text-muted">Avg Packet Loss</h6>
                <h3 class="text-warning">{{ "%.2f"|format(stats.avg_packet_loss) }}%</h3>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- History Table -->
<div class="card shadow">
    <div class="card-header bg-white">
        <h5 class="mb-0">
            <i class="bi bi-list-ul"></i> Log History (100 terakhir)
        </h5>
    </div>
    <div class="card-body">
        {% if logs and logs|length > 0 %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Waktu Pengecekan</th>
                        <th>Status</th>
                        <th>Latency (ms)</th>
                        <th>Packet Loss (%)</th>
                        <th>Response Time (ms)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td>{{ log[6].strftime('%d/%m/%Y %H:%M:%S') if log[6] else '-' }}</td>
                        <td>
                            {% if log[2] == 'online' %}
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle"></i> Online
                            </span>
                            {% else %}
                            <span class="badge bg-danger">
                                <i class="bi bi-x-circle"></i> Offline
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if log[3] is not none %}
                                <span class="badge bg-info">{{ "%.2f"|format(log[3]) }} ms</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if log[4] is not none %}
                                {% if log[4] == 0 %}
                                <span class="badge bg-success">{{ "%.2f"|format(log[4]) }}%</span>
                                {% elif log[4] < 50 %}
                                <span class="badge bg-warning text-dark">{{ "%.2f"|format(log[4]) }}%</span>
                                {% else %}
                                <span class="badge bg-danger">{{ "%.2f"|format(log[4]) }}%</span>
                                {% endif %}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if log[5] is not none %}
                                <span class="badge bg-secondary">{{ "%.2f"|format(log[5]) }} ms</span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> Belum ada history monitoring untuk device ini.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}